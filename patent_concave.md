# 1. 发明名称
一种基于距离变换算法用于分割黏连种子图像的方法
# 2. 说明目前同类技术应用的现状及缺陷
中国是一个农业大国，农业相关部门无一例外都需要统计种子各类信息，其中种子计数是关键的一步，其准确率直接影响到后续的千粒重等信息。目前计数主要分为两种方式：人工计数和机器计数。人工计数过程费时费工，随着种子自动化要求的日益提高，靠人工感官计数效率低下，难以满足现代农业的生产要求。但种子排列情况比较复杂时，人工计数要更准确一些。另一种是通过机器计数，目前市场上的数种仪层出不穷，其通过图像视觉技术进行自动数种的过程大幅度地提高了工作效率。但是机器计数不像人工计数，尤其当机器面对一些复杂的种子排列情况时，由于自身算法的缺陷而造成的误判会直接影响到数种结果，故数种算法还需要进一步的优化与改善。
# 3. 本专利针对同类现有技术或产品要解决的问题
本实用新型技术提供了一种新型的针对种子复杂排列情况下的计数算法，替代掉目前市场上主要采用的基于图形学操作的分割算法和基于凹点匹配的分割算法。基于图形学操作的分割算法用到的是图形学上的腐蚀膨胀操作，但这种算法只适用于黏连程度小的情况，对于黏连情况严重的种子图像则无法实现分割。基于凹点匹配的分割算法是先找到图像上的凹点，然后进行凹点匹配分割，但黏连情况严重的种子图像凹点数目众多，现有的匹配规则会经常出现错误匹配情况，从而导致分割出错或者过分割等问题。本技术基于距离变换算法得到种子图像对应的3D山峰图，利用其中的山谷点进行分割，从而有效避免了凹点匹配算法中因出现过多的凹点而导致凹点匹配易出错的问题。经验证分析，本技术能够解决市场上现有算法无法处理的黏连情况较为严重的种子图像，准确率更高。
# 4. 与现有技术相比，本发明有何优点
1.根据种子形状上的特性，利用距离变换算法将2D种子二值图像转变为3D山峰图，从而更容易得到图像黏连区域的关键信息，从而解决了基于图形学操作的分割算法因目标黏连严重而导致的无法分割的问题。

2.利用3D山峰图上有限的山谷点进行图像分割，避免了基于凹点匹配的分割算法在面对种子黏连情况严重时而出现的凹点数目过多的问题，同时也避免了凹点匹配算法经常出现的“一步错步步错”的问题，从而大幅度提高了数种准确度。
# 5. 本发明技术方案的详细阐述
## 一、总体思路
由于种子原图在图像上属于二值图片（即图片中只有白色和黑色），不能使用根据灰度信息来分割目标物，故只能根据目标物的形状特征来进行分割。为了提高数种精确率，此次实用新型技术所设计出的分割算法将实现复杂黏连情况下种子图像的分割，通过距离变换算法得到3D山峰图，从中提取出用于图像分割的关键信息，然后利用这些信息实现图像分割。

算法实现思路： 

(1)首先将采集到的种子图像进行图像降噪处理，然后使用OSTU算法（大津算法）得到种子图像的二值图。这一步目的在于使算法的注意点集中在目标形状特征上，简化分割问题的复杂度。

(2)将种子二值图进行图像距离变换，得到二值图对应的3D山峰图。同时再对种子二值图使用图像细化算法得到图像的骨骼。将3D山峰图与图像的骨骼进行交集运算，得到带有高度信息的山脊线图像。

(3)对带有高度信息的山脊线图像使用广度优先遍历算法，求出其中的交叉点。利用这些交叉点将原来错综复杂的山脊线分为一条条只包含一个山岭或山谷的山脊线，然后求出这些山脊线谷点的确切位置。在山谷点模拟水滴下落的方式（最大梯度下降法），水滴下落的轨迹即图像分割线。

算法的整体框图如下：

样本图像输入 - 图像预处理得到二值图片 - 求出3D山峰图 - 得到山脊线 - 求出山谷点 - 水滴下落法实现图像分割

## 二、关键模块及技术
### 1.获取带有高度信息的山脊线
先使用距离变换算法对原二值图片进行处理。距离变换是指计算图像中像素点（白色像素）到最近零像素点（黑色像素）的距离，也就是零像素点的最短距离。本算法使用欧式距离变换.

### 2.山脊线谷点搜索算法
### 3.最大梯度下降法

# 本发明欲保护的创新点
1. 利用距离变换算法将种子的二值图像转换成3D山峰图的操作
2. 找到3D山峰图中山脊线的算法。
3. 找到3D山峰图中山谷点的算法。
4. 水滴下落法实现目标物的分割。

